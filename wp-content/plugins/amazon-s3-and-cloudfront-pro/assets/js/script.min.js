!function(a,b,c){function d(){var a=Math.floor(v/3600)%24,b=Math.floor(v/60)%60,c=v%60,d=f(a,2,0)+":"+f(b,2,0)+":"+f(c,2,0);w.html(d)}function e(){v=0,w=a(".timer"),u=setInterval(g,1e3)}function f(a,b,c){return c=c||"0",a+="",a.length>=b?a:new Array(b-a.length+1).join(c)+a}function g(){v+=1,d()}function h(b){!0===C?(C=!1,B=!0,a(".upload-progress-ajax-spinner").show(),a(".pause-resume").html(as3cfpro.strings.pause),u=setInterval(g,1e3),s()):(a(this).off(b),C=!0,B=!1,a(".pause-resume").html(as3cfpro.strings.pausing).addClass("disabled")),k()}function i(a){var b=1024,c=["kB","MB","GB","TB","PB","EB","ZB","YB"];if(b>a)return a+" B";var d=-1;do a/=b,d++;while(a>=b);return a.toFixed(1)+" "+c[d]}function j(b,c,d,e){H=d,I=e,J=b,K=c,G=e>0?Math.round(100*d/e):Math.round(100*J/K),a(".progress-bar").width(G+"%"),k()}function k(){var b=as3cfpro.strings.files_uploaded.replace("%1$d",J).replace("%2$d",K),c=G+"% "+as3cfpro.strings.complete,d="";I>0&&(d="("+i(H)+" / "+i(I)+")"),a(".upload-progress").html(b),!1===C?a(".progress-text").html(c+" "+d):a(".progress-text").html(as3cfpro.strings.completing_current_request)}function l(b){var c=m(b),d=!1,e=as3cfpro.settings.previous_url_whitelist;return a.each(c,function(b,c){return-1!==a.inArray(b,e)&&c!==Q[b]?(d=!0,!1):void 0}),d}function m(b){var c=a(b).serializeArray(),d={};return a.each(c,function(a,b){d[b.name]=b.value}),d}function n(){a.ajax({url:ajaxurl,type:"POST",dataType:"json",cache:!1,data:{action:"as3cfpro_update_upload_notices",nonce:as3cfpro.nonces.update_upload_notices},success:function(b){!0===b.success&&"undefined"!=typeof b.data&&(a(".as3cf-pro-media-notice").remove(),a("#tab-"+as3cf.tabs.defaultTab).prepend(b.data))}})}function o(b){if("support"!==b&&a(".as3cf-pro-check-again").length){var c=a(".as3cf-pro-check-again").attr("href");as3cf.tabs.defaultTab===b&&(b=""),""!==b&&(b="#"+b);var d=c.indexOf("#");0===d&&(d=c.length),c=c.substr(0,d)+b,a(".as3cf-pro-check-again").attr("href",c)}}function p(b){a(".support-content").hasClass("checking-licence")||(a(".support-content").addClass("checking-licence"),a(".support-content p:first").append('<img src="'+F+'" alt="" class="check-license-ajax-spinner general-spinner" />'),a(".as3cf-pro-license-notice").remove(),a.ajax({url:ajaxurl,type:"POST",dataType:"json",cache:!1,data:{action:"as3cfpro_check_licence",licence:b,nonce:as3cfpro.nonces.check_licence},error:function(b,c,d){alert(as3cfpro.strings.license_check_problem),a(".support-content").removeClass("checking-licence")},success:function(b){if("undefined"!=typeof b.dbrains_api_down)a(".support-content").empty().html(b.dbrains_api_down+b.message);else if("undefined"!=typeof b.errors){var c="";for(var d in b.errors)c+=b.errors[d];a(".support-content").empty().html(c)}else a(".support-content").empty().html(b.message);"undefined"!=typeof b.pro_error&&0===a(".as3cf-pro-license-notice").length&&a("h2.nav-tab-wrapper").after(b.pro_error),a(".support-content").removeClass("checking-licence")}}))}var q,r,s,t,u,v,w,x=!1,y=!1,z=!1,A=!1,B=!1,C=!1,D=!1,E=ajaxurl.replace("/admin-ajax.php",""),F=E+"/images/spinner",G=0,H=0,I=0,J=0,K=0,L=0,M=!0,N=!1,O=!1,P=!1,Q=null;window.devicePixelRatio>=2&&(F+="-2x"),F+=".gif",window.onbeforeunload=function(a){return z?(a=a||window.event,a&&(a.returnValue=as3cfpro.strings.sure),as3cfpro.strings.sure):void 0};var R=as3cf.tabs.toggle;as3cf.tabs.toggle=function(a){R(a),"support"===a?"1"===as3cfpro.strings.has_licence&&p():o(a)};var S=as3cf.buckets.set;as3cf.buckets.set=function(b,d,e){var f=a("#"+c.prefix+"-active-bucket").text();S(b,d,e),"as3cf"===c.prefix&&""===f&&n()},a(document).ready(function(){function c(e,g){return b.isEmpty(e)?(j(g.files,g.total_files,g.bytes,g.total_bytes),t={fn:d,args:[g]},void s()):void a.ajax({url:ajaxurl,type:"POST",dataType:"json",cache:!1,data:{action:"as3cfpro_calculate_attachments",blogs:e,progress:g,nonce:as3cfpro.nonces.calculate_attachments},error:function(a,b,c){f(a,b,c)},success:function(a){i(a)||(t={fn:c,args:[a.blogs,a.progress]},s())}})}function d(b){return b.files>=b.total_files?(t={fn:q,args:[b]},void s()):void a.ajax({url:ajaxurl,type:"POST",dataType:"json",cache:!1,data:{action:"as3cfpro_upload_attachments",find_and_replace:M,progress:b,nonce:as3cfpro.nonces.upload_attachments},error:function(a,b,c){f(a,b,c)},success:function(b){if(!i(b)){if("undefined"!=typeof b.errors){var c=a(".progress-errors-title .error-count"),e=parseInt(c.html());a.each(b.errors,function(b,c){e++,a(".progress-errors .progress-errors-detail ol").append("<li>"+c+"</li>"),x=!0}),e>0&&a(".progress-errors").show(),c.html(e),1===e?a(".progress-errors-title .error-text").html(as3cfpro.strings.error):a(".progress-errors-title .error-text").html(as3cfpro.strings.errors)}j(b.files,b.total_files,b.bytes,b.total_bytes),t={fn:d,args:[b]},s()}}})}function f(b,c,d){a(".progress-title").html(as3cfpro.strings.upload_failed),a(".progress-text").not(".media").html(b.responseText),a(".progress-text").not(".media").addClass("upload-error"),console.log(b),console.log(c),console.log(d),y=!0,r(),B=!1}function g(b){y=!0,r(),a(".progress-title").html(as3cfpro.strings.upload_failed),a(".progress-text").addClass("upload-error"),a(".progress-text").html(b),a(".upload-controls").fadeOut(),B=!1}function i(a){return"undefined"!=typeof a.as3cfpro_error&&1===a.as3cfpro_error?(g(a.body),!0):"undefined"!=typeof a.success&&!1===a.success?(g(a.data),!0):!1}function k(){a(".modal-content").animate({top:"-"+L+"px"},400,"swing",function(){a("#overlay").remove(),a(".modal-content").remove()}),A=!1,N=!1,O=!1}function v(b,c){a(".licence-input, .register-licence").remove(),a(".licence-not-entered").prepend(b.masked_licence),a(".support-content").empty().html("<p>"+as3cfpro.strings.fetching_license+"</p>"),n(),p(c)}var w="";window.location.hash&&(w=window.location.hash.substring(1)),o(w);var E,G,H=a("#tab-"+as3cf.tabs.defaultTab+" .as3cf-main-settings form");Q=m(H);var I=a(".progress-content").clone(),J=a(".redirect-content").clone();a(".progress-content").remove(),a(".redirect-content").remove(),a("body").on("click","#tab-"+as3cf.tabs.defaultTab+' .as3cf-main-settings button[type="submit"]',function(b){l(H)&&a(".as3cf-find-replace-container").length&&(b.preventDefault(),as3cfFindAndReplaceSettings.open(H))}),a("body").on("click","a.as3cf-pro-upload",function(b){E=J.clone(),b.preventDefault();var c=a(document).height();a("body").append('<div id="overlay"></div>'),a("#overlay").height(c).css({position:"fixed",top:0,left:0,width:"100%","z-index":99999,display:"none"}),a("#overlay").after(E),a("#overlay").show(),a(".redirect-options").on("change",'input[name="existing-links"]',function(b){"nothing"===a(this).val()&&"1"===as3cfpro.settings.remove_local_file?a(".redirect-options .nothing").next(".notice-warning").addClass("show"):a(".redirect-options .nothing").next(".notice-warning").removeClass("show")}),L=E.outerHeight(),E.css("top","-"+L+"px").show().animate({top:"0px"}),O=!0}),a("body").on("click",".as3cf-start-upload",function(b){G=I.clone(),b.preventDefault(),M="replace"===a('input[name="existing-links"]:checked').val()?!0:!1,E.animate({top:"-"+L+"px"},400,"swing",function(){a(this).remove(),O=!1,a("#overlay").after(G),L=G.outerHeight(),G.css("top","-"+L+"px").show().animate({top:"0px"}),N=!0,a(".upload-controls .cancel").after('<img src="'+F+'" alt="" class="upload-progress-ajax-spinner general-spinner" />'),e()}),z=!0,B=!0,a.ajax({url:ajaxurl,type:"POST",dataType:"json",cache:!1,data:{action:"as3cfpro_initiate_upload",nonce:as3cfpro.nonces.initiate_upload},error:function(a,b,c){f(a,b,c)},success:function(a){if(!i(a)){var b={bytes:0,files:0,total_bytes:0,total_files:0};t={fn:c,args:[a,b]},s()}}})}),r=function(){if(!1===y&&!0===x){a(".progress-text").addClass("upload-error");var b=as3cfpro.strings.completed_with_some_errors;!0===D&&(b=as3cfpro.strings.partial_complete_with_some_errors),a(".progress-text").html(b)}y=!1,z=!1,A=!0,C=!1,D=!1,B=!1,x=!1,a(".progress-label").remove(),a(".upload-progress-ajax-spinner").remove(),a(".close-progress-content").show(),a("#overlay").css("cursor","pointer"),clearInterval(u),a.ajax({url:ajaxurl,type:"POST",dataType:"json",cache:!1,data:{action:"as3cfpro_finish_upload",nonce:as3cfpro.nonces.finish_upload},success:function(){n()}})},q=function(){a(".upload-controls").fadeOut(),z=!1,!1===y&&(a(".progress-text").append('<div class="dashicons dashicons-yes"></div>'),r())},s=function(){return!0===C?(a(".upload-progress-ajax-spinner").hide(),clearInterval(u),a(".progress-text").html(as3cfpro.strings.paused),a("body").on("click",".pause-resume",function(a){h(a)}),void a(".pause-resume").html(as3cfpro.strings.resume).removeClass("disabled")):void(!0===D?(a(".progress-text").html(as3cfpro.strings.upload_cancelled),r()):t.fn.apply(null,t.args))},a("body").on("click",".pause-resume",function(a){h(a)}),a("body").on("click",".cancel",function(){D=!0,C=!1,a(".upload-controls").fadeOut(),a(".upload-progress-ajax-spinner").show(),a(".progress-text").html(as3cfpro.strings.completing_current_request),!1===B&&s()}),a("body").on("click",".close-progress-content-button, .close-redirect-content-button",function(a){k()}),a("body").on("click","#overlay",function(){(!0===O||!0===N&&!0===A)&&k()}),a("body").on("click",".toggle-progress-errors",function(b){b.preventDefault();var c=a(this),d=c.closest(".progress-errors-title").siblings(".progress-errors-detail");return d.toggle(0,function(){c.html(a(this).is(":visible")?as3cfpro.strings.hide:as3cfpro.strings.show)}),!1}),a("body").on("click","a.as3cf-pro-notice",function(b){b.preventDefault();var c=a(this);c.closest(".as3cf-notice").hide(),a.ajax({url:ajaxurl,type:"POST",dataType:"json",cache:!1,data:{action:"as3cfpro_dismiss_notice",nonce:as3cfpro.nonces.dismiss_notice,notice:c.data("notice")},error:function(a,b,d){c.closest(".as3cf-notice").show()},success:function(a){!1===a.success&&c.closest(".as3cf-notice").show()}})}),a(".enter-licence").click(function(b){b.preventDefault(),as3cf.tabs.toggle("support"),window.location.hash="support",a(".licence-input").focus()}),a(".licence-form").submit(function(b){if(b.preventDefault(),!P){a(".licence-status").removeClass("notification-message error-notice success-notice");var c=a.trim(a(".licence-input").val());if(""===c)return a(".licence-status").addClass("notification-message error-notice"),void a(".licence-status").html(as3cfpro.strings.enter_license_key);a(".as3cf-pro-license-notice").remove(),a(".licence-status").empty().removeClass("success"),P=!0,a(".button.register-licence").attr("disabled",!0),a(".button.register-licence").after('<img src="'+F+'" alt="" class="register-licence-ajax-spinner general-spinner" />'),a.ajax({url:ajaxurl,type:"POST",dataType:"JSON",cache:!1,data:{action:"as3cfpro_activate_licence",licence_key:c,nonce:as3cfpro.nonces.activate_licence},error:function(b,c,d){P=!1,a(".register-licence-ajax-spinner").remove(),a(".licence-status").html(as3cfpro.strings.register_license_problem),a(".button.register-licence").attr("disabled",!1)},success:function(b){if(P=!1,a(".button.register-licence").attr("disabled",!1),a(".register-licence-ajax-spinner").remove(),"undefined"!=typeof b.errors){var d="";for(var e in b.errors)d+=b.errors[e];a(".licence-status").html(d),"undefined"!=typeof b.masked_licence&&v(b,c)}else"undefined"!=typeof b.wpmdb_error&&"undefined"!=typeof b.body?a(".licence-status").html(b.body):(a(".licence-status").html(as3cfpro.strings.license_registered).delay(5e3).fadeOut(1e3),a(".licence-status").addClass("success notification-message success-notice"),v(b,c),a(".invalid-licence").hide());"undefined"!=typeof b.pro_error&&0===a(".as3cf-pro-license-notice").length&&a("h2.nav-tab-wrapper").after(b.pro_error)}})}}),a("body").on("click",".reactivate-licence",function(b){b.preventDefault();var c=a("<div/>",{id:"processing-licence"}).html(as3cfpro.strings.attempting_to_activate_licence);c.append('<img src="'+F+'" alt="" class="check-license-ajax-spinner general-spinner" />'),a(".invalid-licence").hide().after(c),a.ajax({url:ajaxurl,type:"POST",dataType:"json",cache:!1,data:{action:"as3cfpro_reactivate_licence",nonce:as3cfpro.nonces.reactivate_licence},error:function(b,d,e){c.remove(),a(".invalid-licence").show().html(as3cfpro.strings.activate_licence_problem),a(".invalid-licence").append("<br /><br />"+as3cfpro.strings.status+": "+b.status+" "+b.statusText+"<br /><br />"+as3cfpro.strings.response+"<br />"+b.responseText)},success:function(b){return c.remove(),"undefined"!=typeof b.as3cfpro_error&&1===b.as3cfpro_error?void a(".invalid-licence").html(b.body).show():"undefined"!=typeof b.dbrains_api_down&&1===b.dbrains_api_down?(a(".invalid-licence").html(as3cfpro.strings.temporarily_activated_licence),void a(".invalid-licence").append(b.body).show()):(a(".invalid-licence").empty().html(as3cfpro.strings.licence_reactivated),a(".invalid-licence").addClass("success notification-message success-notice").show(),void location.reload())}})}),a("body").on("click",".support-tab-link",function(a){as3cf.tabs.toggle("support")})})}(jQuery,_,as3cfModal);